# Общая информация

Инструмент для управления воркспейсами в yarn v1.
Помогает осуществлять релизы и управлять версиями воркспейсов.

Для запуска достаточно `package.json` с настроенным рабочими областями (https://classic.yarnpkg.com/ru/docs/workspaces/).
При запуске `rollman` ищет файл `package.json` в текущей директории и в родительских директориях.

# Выпуск новых версий пакетов

Команда `rollman release` запускает интерактивный релиз пакетов.
Для этого нужно, чтобы все изменения в пакетах были закоммичены, а репозитории были переключены на ветку, в которой разрешены релизы (по умолчанию `master`).

`rollman` проверяет список коммитов, которые появились в каждом из пакетов после последнего инкремента версии, и предлагает изменить версию там, где появились новые коммиты.
После увеличения версии будет автоматически добавлен новый коммит с изменившимися файлами и новый релизный тег, указывающий на этот коммит.

В тех пакетах, которые больше не зависят от последней версии другого воркспейса, будет предложено изменить диапазон совместимых версий.
Эти изменения тоже будут автоматически закоммичены.

## Генерация npm-локфайлов

`rollman` может генерировать файлы `package-lock.json` для пакетов.
Сгенерированные локфайлы отражают состояние установленных на данный момент зависимостей конкретного модуля, в него не включаются зависимости, которые, хотя и присутствуют в общей директории `node_modules`, но установлены туда из-за того, что их требует другой воркспейс.

Чтобы включить генерацию локфайлов, нужно добавить свойство `useLockFiles` в конфиг проекта.
По умолчанию локфайл генерируется только для тех пакетов, где `rollman` во время релиза изменял зависимости от локальных модулей или увеличивал версию.
Чтобы генерировать локфайл при каждом релизе, нужно указать `alwaysUpdateLockFile` в конфигурации проекта.
Это свойство можно переопределить в `package.json` отдельного модуля.

## Lifecycle-скрипты

Во время релиза выполняются lifecycle-скрипты.
Первым выполняется скрипт, описанный в корневом `package.json`, а при обработке каждого модуля — скрипт, описанный в его `package.json`.

Если скрипт завершается с ненулевым кодом, релиз прерывается.

Если скрипт делает какие-либо изменения в исходных файлах, они будут автоматически закоммичены отдельным коммитом.

# Конфигурация проекта

Для конфигурации проекта в корневом `package.json` (в том, где указано свойство `workspaces`), можно добавить свойство `rollman`, где поддерживаются такие значения (все они опциональны, а в качестве примера указано значение по умолчанию):

```json
{
  "name": "package",
  "workspaces": { },
  "rollman": {
    "useLockFiles": false,
    "alwaysUpdateLockFile": false,
    "useGitTags": true,
    "releaseBranches": [ "master" ]
  }
}
```

`useGitTags` — позволяет отключить автоматическое добавление тега для коммита с новой версией.

`releaseBranches` — список веток, для которых разрешены релизы.
